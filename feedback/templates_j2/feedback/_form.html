{% set form_id = form.auto_id|format("form") %}

<div id="exercise" class="jutut-exercise" lang="{{ get_current_language() }}">

	{# Response #}
	{% if feedback and feedback.response_msg %}
		<div class="alert alert-info">
			<p><strong>{{ _("Staff response") }}</strong></p>
			<p>{{ feedback.response_msg }}</p>
		</div>
	{% endif %}

	{# Form #}
	<form id="{{ form_id }}" action="{{ post_url }}" method="post" class="form">

		{{ form|bootstrap }}

		<div class="only-when-edited alert alert-warning" style="display: none;">
			{{ _("This feedback has unsaved changes!") }}
		</div>

		<div class="form-group">
			<div class="btn-toolbar">
				<input
					type="submit"
					value="{% if feedback %}{{ _('Submit an update') }}{% else %}{{ _('Submit') }}{% endif %}"
					class="btn btn-primary aplus-submit">
				<input
					type="reset"
					value="{{ _('Reset changes') }}"
					class="btn btn-danger only-when-edited">
			</div>
		</div>
	</form>

	{# UI interaction #}
	<script>
		(function($) {
			var f = $('#{{ form_id }}'),
				o = f.find('.only-when-edited'),
				i = f.serialize(), s = false;
			f.find(':input').on('change input', function() {
				var n = f.serialize() !== i;
				if (s !== n) o.toggle(s = n);
			});
			f.find("input[type='reset']").on('click', function(e) {
				e.preventDefault();
				f.each(function(){this.reset();});
				o.hide(); s = false;
			});
			o.hide();
		})(jQuery);
	</script>
</div>

